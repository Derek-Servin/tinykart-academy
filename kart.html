<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Chapter 4: The TinyKart - the tinykart book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="why.html"><strong aria-hidden="true">1.1.</strong> Why TinyKart</a></li></ol></li><li class="chapter-item expanded "><a href="bom.html"><strong aria-hidden="true">2.</strong> Hardware BOM and Overview</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">3.</strong> Chapter 1: Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation_pio.html"><strong aria-hidden="true">3.1.</strong> PlatformIO</a></li><li class="chapter-item expanded "><a href="installation_git.html"><strong aria-hidden="true">3.2.</strong> Git</a></li><li class="chapter-item expanded "><a href="code_setup.html"><strong aria-hidden="true">3.3.</strong> Setup</a></li></ol></li><li class="chapter-item expanded "><a href="soft_overview.html"><strong aria-hidden="true">4.</strong> Chapter 2: Software Overview</a></li><li class="chapter-item expanded "><a href="lidar.html"><strong aria-hidden="true">5.</strong> Chapter 3: The Baby Lidar</a></li><li class="chapter-item expanded "><a href="kart.html" class="active"><strong aria-hidden="true">6.</strong> Chapter 4: The TinyKart</a></li><li class="chapter-item expanded "><a href="auton_intro.html"><strong aria-hidden="true">7.</strong> Chapter 5: The Self Driving Part</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="auton_gap.html"><strong aria-hidden="true">7.1.</strong> Pt.1: Follow the Gap</a></li><li class="chapter-item expanded "><a href="auton_pp.html"><strong aria-hidden="true">7.2.</strong> Pt.2: Pure Pursuit</a></li></ol></li><li class="chapter-item expanded "><a href="onwards.html"><strong aria-hidden="true">8.</strong> Chapter 6: Onwards</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">the tinykart book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="moving-the-kart"><a class="header" href="#moving-the-kart">Moving the Kart</a></h1>
<p>Now that you have given TinyKart its proverbial eyes with the LiDAR, it's time to give it its proverbial legs (this
sounded better on paper lol). Specifically, we will be going over how to actually make the kart steer and accelerate.
Much like the LiDAR, you won't be writing all the driver code, but it's very important to understand how it all works,
since the patters appear all over embedded programming.</p>
<h2 id="hardware"><a class="header" href="#hardware">Hardware</a></h2>
<p>Before we can program the hardware, we first need to discuss, well, the hardware! In robotics, anything that can make
a piece of a robot move is called an <strong>actuator</strong>. For example, the wheels on a Roomba, or the claw on Spot.</p>
<p>The Traxxas Slash has two main means of actuation:</p>
<ol>
<li>Steering</li>
<li>Accelerating the rear wheels</li>
</ol>
<p>Steering is achived with a servo motor:</p>
<img style="width: 100%" src="data:image/jpeg;base64,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"/>
<p>Servos are motors that are designed to hold a particular position, rather than continuing to rotate. By adding another
linkage, this rotational angle can be converted to a linear position, thus creating a linear actuator that can hold a
particular
distance. As it turns out, that's exactly how steering works! Essentially, mechanical linkages are geometrically
connected
to the servo such that each far end of the servos range will cause the wheels to reach their max turning angle.</p>
<p>On the other hand, accelerating is something that requires a continues axis, so a servo would make no sense. In this
case,
the RC car simply uses a brushed DC motor:</p>
<img src="https://m.media-amazon.com/images/W/MEDIAX_792452-T2/images/I/61jmRJo1eiL._AC_UF1000,1000_QL80_.jpg">
<p>While discussion on brushed motors is better done by the more electrically inclined, a simple way to understand these
things
is that when you apply a voltage across the two leads, a magnetic field in the motor forms, moving the output shaft:</p>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/89/Electric_motor.gif/200px-Electric_motor.gif">
<p>Critically, the polarity of the voltage across the leads must switch, or else the motor will just stall. Thankfully,
there is dedicated hardware designed to do this for us, called a <strong>motor controller</strong> or <strong>ESC (Electronic Speed
Control)</strong>.
The ESC on the Slash looks like this:</p>
<img style="width: 100%" src="https://cdn11.bigcommerce.com/s-sdwy6qdoez/images/stencil/1280x1280/products/3904/4274/TRA3018R-1__97045.1526417195.jpg?c=2">
<p>The ESC sits between the battery and the motor, controlling the polarity and power as required to reach some level of
output speed. This means that when we want to move the motor, we need to interact with the ESC.</p>
<h2 id="interface"><a class="header" href="#interface">Interface</a></h2>
<p>So how to we actually control these actuators? Conveniently, they actually use the same exact interface. That is <strong>Pulse
Width Modulation (PWM)</strong>.</p>
<p>PWM shows up all over electrical things, both as an effectively analog power source, and as a digital signal, as it is
used here.
The idea of PWM is to represent an analog range like 0-100% using a digital signal, which can naturally only be 0 or 1.
While this could be done by sending binary integers, that would be extremely inefficient. Instead, PWM works by creating
set periods of time. Inside these periods, the percentage of time the signal is high versus low is the analog value
itself,
called the <strong>duty cycle</strong>. For a visualisation:</p>
<img style="width: 100%" src="https://upload.wikimedia.org/wikipedia/commons/b/b8/Duty_Cycle_Examples.png">
<p>The issue with this approach is that because the duty cycle is time on over period, the frequency of the PWM signal must
be set in stone. For historical reasons, RC cars do not like this, and use a different approch, called <strong>Pulse <em>Period</em>
Modulation</strong>.</p>
<p>In this formulation, 0-100% is not the duty cycle, but rather a range of <em>time</em> the signal is high versus low. For
example,
most servos use 1.0ms high for min angle, 1.5ms high for their midpoint, and 2.0ms for their max angle. This approach
means
that any frequency with a period greater than 2.0ms can control the servo, allowing it to work with very cheap hardware.</p>
<p>As it turns out, this is also exactly how the ESC works! The only difference being that 1.0ms is full reverse, and 2.0ms
is full forward power.</p>
<h2 id="setting-up-the-hardware"><a class="header" href="#setting-up-the-hardware">Setting up the hardware</a></h2>
<p>Alright, now it's time for you to set up your controller to connect to these actuators. To do this, we're going to have
to do a tiny bit of wiring to get stuff setup. Each of the actuators has a connector like this:</p>
<img src="https://tinycircuits.com/cdn/shop/products/ASR00013-02_740x.png?v=1579634111">
<p>For the servo these pins mean:</p>
<ul>
<li>Red: 5V in, to power the servo</li>
<li>Black: Ground</li>
<li>White: PWM control signal in</li>
</ul>
<p>For the ESC these pins mean:</p>
<ul>
<li>Red: 5V <strong>out</strong>, to power the servo</li>
<li>Black: Ground, to battery</li>
<li>White: PWM control signal in</li>
</ul>
<p>Our goals for wiring things up is to:</p>
<ol>
<li>Connect ESC 5V out to servo 5V in</li>
<li>Connect ESC and servo PWM to pins on the controller</li>
<li>Connect all three to common ground</li>
</ol>
<p>To do this:</p>
<ol>
<li>Make sure the system is powered off</li>
<li>Jump the ESC 5V to servo 5V</li>
<li>Jump ESC and Servo ground together using a breadboard</li>
<li>Jump a ground pin from the controller to the same breadboard lane as the other two grounds, creating a common ground</li>
<li>Finally, jump the ESC and Servo PWM lines to these exact pins:</li>
</ol>
<img style="width: 100%" src="assets/actuator_connect.png">
<p>Red being A0, and green being D0.</p>
<p>Now, connect the battery to the esc, and power to the controller. Now, press and hold the little blue
button on the ESC to turn it on. Finally, reset the controller. You should see the kart do a little jump, and
maybe move its wheels. This is good! This means that the ESC is armed, and ready to move.</p>
<h2 id="the-code"><a class="header" href="#the-code">The code</a></h2>
<p>Now that things are hooked up, you can move the kart with commands on the TinyKart class:</p>
<pre><code class="language-c++">tinyKart-&gt;set_forward(command.throttle_percent);
tinyKart-&gt;set_steering(command.steering_angle);
</code></pre>
<p>Feel free to explore the other methods on the class, as they allow for movement in other ways, such as in reverse.</p>
<p>While this high level API is all you will be working with for the autonomy, I want to briefly show how its implemented:</p>
<pre><code class="language-c++">        analogWrite(pwm_pin, value);
    }

    /// Sets the esc to power forward with some 0.0-1.0 percent.
    void set_forward(float power) {
        assert(power &lt;= 1.0 &amp;&amp; power &gt;= 0.0);

        this-&gt;was_forward = true;
</code></pre>
<p>As you can see, its actually rather simple, thanks to Arduino. I want to untangle that second line for you, since
there's
really two things going on here.</p>
<p>First, the value of that line is the value we are setting the hardware PWM peripheral's register to control the duty
cycle. Because PWM is digital, we can only output duty cycle percents up to some resolution in bits. Think of these as
buckets,
and the more buckets we have the more we can slice the 0-100% range into finer pieces to uniformly distribute among the
buckets. For example, Arduino defaults to an 8 bit PWM, which means that setting the register to 255 will be 100% duty
cycle,
0 will be 0%, and 255//2 will be closeish to 50%.</p>
<p>In the case of our ST board, we have a 12-bit PWM, which means that we have 4092 "buckets". This means to select some
percent
duty cycle, you use the equation: \( power * 4092 \), where power is in range [0, 1].</p>
<p>Second, the <code>analogWrite</code> call sets duty cycle, not duty width, which is what we're looking for. This means that we need
to map our desired percent first from percent to width in ms, then from ms to duty cycle, then duty cycle to register
value. This is exactly what that one-liner is doing. From left to right:</p>
<ol>
<li>Our forward time range is 1.5-2.0ms, so divide our power by 2 and add it to 1.5, to get our desired percent in time
domain.</li>
<li>We need this time width in duty cycle, so we now need to find the percent of time that width takes out of the
complete PWM period.
To do this, we just divide by the period, which is just a constant set in <code>setup()</code>.</li>
<li>Finally, take this 0.0-1.0 duty cycle and multiply it by the max register value (4092 here) to get the value to write
to the register.</li>
<li>Write the value to the register using <code>analogWrite</code>.</li>
</ol>
<p>The servo works exactly the same, except split over left vs right rather than reverse vs forwards.</p>
<h3 id="stop-and-think"><a class="header" href="#stop-and-think">Stop and think</a></h3>
<p>Now I said this is important to understand, even if you won't be writing it. Now's the time to ponder how this setup
could
influence the autonomy. Before you see the explanation, please think this over for a moment, to make sure you have a
good grasp on things.</p>
<details>
  <summary>An answer</summary>
<p>I would say this setup has two main consequences upstream in the autonomy stack:</p>
<ol>
<li>Latency</li>
<li>Precision</li>
</ol>
<p>First, because PWM signals have a set period width, this limits the rate at which we can update the steering and speed,
since we must wait for the prior PWM period to end before we can change the duty cycle. While this isn't of massive
significance,
It's something to consider as adding, ex. 10ms of latency at 100Hz (what the reference code you have is using) is
actually
quite a large value on the embedded world.</p>
<p>Second, 12-bits of resolution is quite high, but because we are stuck with only using small period ranges, we actually
have very little resolution. This means that while you can still get rather specific with your steering angles (
certainly fine for our use),
small angle increments can sometimes have no effect or a large effect depending on if it causes us to step into
another "bucket".</p>
<p>While neither of these are really something you need to worry about, its worth taking the time to think about how your
hardware will constrain your autonomous routines, as this is something that is far more pronounced on a full size
vehicle.</p>
</details>
<h2 id="homework"><a class="header" href="#homework">Homework</a></h2>
<p>Alright, now it's your turn to make the funny RC car move. Keep building off your last code, although you will need to
hack it a bit.</p>
<p>Your challenge today is to make the kart slow proportionally to the distance in front of it. This will be very useful in
the autonomous routines later, as it will help prevent the kart from sliding around. Doing this will require you to use
distance values from the LiDAR again, but with it facing forward as is proper. Specifically, the kart should be able to
avoid hitting an object with much speed, and preferably stop before hitting it at all. Consider experimenting with
using reverse as a brake.</p>
<p>Start slow and build your way up in speed and see how fast you can go! This experience will come in handy later when
testing autonomous things.</p>
<p>Note that when the kart boots, it starts in a paused state, indicated by the yellow LED. In this state, it rejects all
commands. To allow it to move, press the blue button. Press the button again to stop the kart (this is what you were
doing the first day!). If you want to use this functionality in your own code (like to stop if the kart hit something):</p>
<pre><code class="language-c++">tinykart-&gt;pause(); // Stops
tinykart-&gt;unpause(); // Starts
</code></pre>
<p>Some notes before you start:</p>
<ul>
<li>When running the kart in motion, make sure everything is well secured. Perhaps consult your friendly ME peers to see
how to do this well. In particular, if ground is disconnected the kart goes wild, so be careful.</li>
<li>The controller can be powered off of mobile battery banks, not just from a laptop. Use this to make the kart cordless.
The controller will boot to its last flashed code.</li>
<li>The kart is fast! On slippery floor especially it can really get away from you, so I recommend capping the speed at
around
0.3 at most. It also tends to stall around 0.15. For grippier floors like carpet, move that range up a bit.</li>
</ul>
<p>To set the karts max speed, modify the 3rd parameter in the TinyKart constructor:</p>
<pre><code class="language-c++">    tinyKart = new TinyKart{STEERING_PIN, esc, 0.3, 4.5};
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="lidar.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="auton_intro.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="lidar.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="auton_intro.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
